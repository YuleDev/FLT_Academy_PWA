<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>FLT Academy Portal</title>

  <link rel="manifest" href="/FLT_Academy_PWA/Views/HTML/manifest.json?v=v4" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="FLT Portal" />

  <link rel="stylesheet" href="/FLT_Academy_PWA/Views/CSS/style.css?v=2026-01-30-1">
</head>

<body>
  <div class="app-wrapper">
    <header>
      <h1>FLT Portal</h1>
      <div id="connection-status">Online</div>
    </header>

    <main id="app"></main>
  </div>

  <script src="/FLT_Academy_PWA/Models/models.js?v=2026-01-30-1"></script>
  <script src="/FLT_Academy_PWA/Controllers/app.js?v=2026-01-30-1"></script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      try {
        const reg = await navigator.serviceWorker.register(
          "/FLT_Academy_PWA/sw.js?v=2026-01-30-1"
        );

        // Ask the browser to check for an updated SW right now
        reg.update();

        // If thereâ€™s already a waiting SW, activate it immediately
        if (reg.waiting) {
          reg.waiting.postMessage({ type: "SKIP_WAITING" });
        }

        reg.addEventListener("updatefound", () => {
          const newWorker = reg.installing;
          if (!newWorker) return;

          newWorker.addEventListener("statechange", () => {
            // When the new SW is installed, tell it to activate immediately
            if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
              newWorker.postMessage({ type: "SKIP_WAITING" });
            }
          });
        });

        // When the SW takes over, reload so the new assets are used immediately
        let reloaded = false;
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          if (reloaded) return;
          reloaded = true;
          window.location.reload();
        });
      } catch (err) {
        console.error("SW registration failed:", err);
      }
    });
  }
</script>
</body>
</html>
